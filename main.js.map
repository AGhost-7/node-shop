{"version":3,"sources":["index.coffee","main.js","masks.coffee","home.coffee","products.coffee","login.coffee","nav.coffee","cart.coffee","purchases.coffee","register.coffee"],"names":["app","cartCtrl","homeCtrl","loginCtrl","navCtrl","productCtrl","purchasesCtrl","registerCtrl","angular","module","config","$routeProvider","when","templateUrl","controller","otherwise","redirectTo","run","$rootScope","$http","$location","permissions","username","get","success","data","name","logged","notLogged","$on","ev","newLoc","oldLoc","loc","prevent","substring","lastIndexOf","some","elem","preventDefault","path","directive","restrict","require","link","scope","el","attrs","ctrl","last","$parsers","push","input","val","match","$setViewValue","$render","$scope","$routeParams","j","len","paramNames","ref","search","watchParams","page","manufacturers","categories","concat","params","length","method","url","items","$watch","n","o","purchase","item","amount","id","_this","quantity","filter","e","this","range","from","to","results","k","apply","changePage","i","login","pw","password","error","message","logout","post","methods","key","remove","index","res","splice","subtotal","tax","total","receipts","register","password2","email"],"mappings":"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","file":"main.js","sourcesContent":["\napp = angular.module('node-shop', ['ngRoute'])\n\napp\n.config(['$routeProvider', ($routeProvider) ->\n  $routeProvider\n    .when('/home',\n      templateUrl: '/html/home.tmpl'\n      controller: 'homeCtrl'\n    )\n    .when('/product',\n      templateUrl: '/html/products.tmpl'\n      controller: 'productCtrl'\n    )\n    .when('/login',\n      templateUrl: '/html/login.tmpl'\n      controller: 'loginCtrl'\n    )\n    .when('/cart',\n      templateUrl: 'html/cart.tmpl'\n      controller: 'cartCtrl'\n    )\n    .when('/register'\n      templateUrl: 'html/register.tmpl'\n      controller: 'registerCtrl'\n    )\n    .when('/purchases'\n      templateUrl: 'html/purchases.tmpl'\n      controller: 'purchasesCtrl'\n    )\n    .otherwise(redirectTo: '/home')\n\n])\n.run(['$rootScope', '$http', '$location', ($rootScope, $http, $location) ->\n  $rootScope.username = undefined\n\n  $http\n    .get('/user')\n    .success((data) -> $rootScope.username = data.name)\n\n  permissions =\n    logged: ['purchases', 'cart', 'product', 'home']\n    notLogged: ['login', 'home', 'product', 'register']\n\n  $rootScope.$on('$locationChangeStart', (ev, newLoc, oldLoc) ->\n    loc = newLoc.substring(newLoc.lastIndexOf('/') + 1)\n    prevent = false\n    if $rootScope.username?\n      if !permissions.logged.some((elem) -> loc == elem)\n        prevent = true\n    else\n      # user isn't logged in\n      if !permissions.notLogged.some((elem) -> loc == elem)\n        prevent = true\n        ev.preventDefault()\n\n    if prevent\n      ev.preventDefault()\n      if newLoc == oldLoc\n        $location.path('/home')\n  )\n])\n",null,"\napp\n.directive('currencyModel', ->\n  restrict: 'A'\n  require: 'ngModel'\n  link : (scope, el, attrs, ctrl) ->\n    last = undefined\n    ctrl.$parsers.push((input) -> \n      if !el.val().match(/^[0-9]*[.]{0,1}[0-9]{0,2}$/g)\n        ctrl.$setViewValue(last)\n        ctrl.$render()\n      else\n        last = el.val()\n    )\n)\n.directive('intModel', ->\n  restrict: 'A'\n  require: 'ngModel'\n  link: (scope, el, attrs, ctrl) ->\n    last = undefined\n    ctrl.$parsers.push((input) ->\n      if !el.val().match(/^[0-9]*$/g)\n        ctrl.$setViewValue(last)\n        ctrl.$render()\n      else\n        last = el.val()\n    )\n)\n","\nhomeCtrl = ($scope) ->\n\napp.controller('homeCtrl', ['$scope', homeCtrl])\n","\nproductCtrl = ($scope, $routeParams, $http) ->\n\n  $scope.page = $routeParams.page ? 1\n  $scope.manufacturers = []\n  $scope.categories = []\n\n  watchParams = ['name', 'minprice', 'maxprice', 'manufacturer', 'category', 'order']\n  paramNames = watchParams.concat('page')\n\n  search = ->\n    params = {}\n    for name in paramNames\n      if $scope[name]? && $scope[name] != ''\n        params[name] = $scope[name]\n    $http(method: 'GET', url: '/product', params: params)\n      .success((data) ->\n        $scope.items = data\n      )\n\n  for name in watchParams\n    $scope.$watch(name, (n, o)->\n      if n != o\n        $scope.page = 1\n        search()\n    )\n  $scope.$watch('page', search)\n\n  $scope.purchase = (item, amount) ->\n    $http(\n      method: 'POST'\n      url: \"/cart/#{item.id}/#{amount}\"\n    )\n    .success((data) =>\n      item.quantity -= amount\n      if item.quantity == 0\n        $scope.items = $scope.items.filter((e) -> e.id != item.id)\n      else\n        # Make it so that the dropdown goes back to its original state\n        this.amount = undefined\n    )\n\n  $scope.range = (from, to) -> [undefined].concat([from..to])\n\n  $http\n    .get('/product/manufacturer')\n    .success((data) ->\n      $scope.manufacturers = [undefined].concat(data)\n    )\n\n  $http\n    .get('/product/category')\n    .success((data) ->\n      $scope.categories = [undefined].concat(data)\n    )\n\n  $scope.changePage = (i) ->\n    if $scope.page + i > 0 then $scope.page += i\n\n\n\napp.controller('productCtrl', ['$scope', '$routeParams', '$http', productCtrl])\n","loginCtrl = ($scope, $http, $location, $rootScope) ->\n\n  $scope.login = (n, pw)->\n    $http(\n      method: 'POST'\n      url: '/user/login'\n      data:\n        name: n\n        password: pw\n    )\n    .success((data) ->\n      $rootScope.username = data.name\n      $location.path('/home')\n    )\n    .error((data) ->\n      $scope.error = data.message\n    )\n\napp.controller('loginCtrl',\n    ['$scope', '$http', '$location', '$rootScope', loginCtrl])\n","\nnavCtrl = ($scope, $rootScope, $http) ->\n\n  $scope.logout = ->\n    $http\n      .post('/user/logout')\n      .success( ->\n        $rootScope.username = undefined\n      )\n\napp.controller('navCtrl', ['$scope', '$rootScope', '$http', navCtrl])\n","\n\ncartCtrl = ($scope, $http) ->\n  $scope.methods = ['Paypal', 'Credit']\n\n  $http\n    .get('/cart')\n    .success((data) ->\n      for key, val of data\n        $scope[key] = val\n    )\n\n  $scope.remove = (item, index) ->\n    $http\n      .delete('/cart/' + item.id)\n      .success((res) ->\n        $scope.items.splice(index, 1)\n        $scope.subtotal = res.subtotal\n        $scope.tax = res.tax\n        $scope.total = res.total\n      )\n  \n  $scope.purchase = (method)->\n    $http\n      .post('/purchase', method: method)\n      .success((res) ->\n        $scope.items = []# don't need to update rest...\n        $scope.error = undefined\n      )\n      .error((res) -> $scope.error = res.message)\n\n\napp.controller('cartCtrl', ['$scope', '$http', cartCtrl])\n","purchasesCtrl = ($scope, $http)->\n  $scope.receipts = []\n  $http\n    .get('/purchase')\n    .success((res) ->\n      $scope.receipts = res\n    )\n\napp.controller('purchasesCtrl', ['$scope', '$http', purchasesCtrl])\n","\nregisterCtrl = ($scope, $http, $rootScope, $location) ->\n\n  $scope.register = ->\n    if $scope.password != $scope.password2\n      $scope.error = 'Passwords do not match'\n    else\n      $http(\n        url: '/user/register'\n        method: 'POST'\n        data:\n          name: $scope.name\n          email: $scope.email\n          password: $scope.password\n          )\n        .success((res) ->\n          $rootScope.username = res.name\n          $location.path('/home')\n        )\n        .error((res) ->\n          $scope.error = res.message\n        )\n\napp.controller('registerCtrl',\n    ['$scope', '$http', '$rootScope', '$location', registerCtrl])\n"],"sourceRoot":"/source/"}